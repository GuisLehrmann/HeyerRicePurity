<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>The rice Heyer purity test</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Pin all React-related deps so every library shares the SAME React instance -->
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.2.0",
          "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
          "react-dom": "https://esm.sh/react-dom@18.2.0",
          "framer-motion": "https://esm.sh/framer-motion@11.2.10?deps=react@18.2.0,react-dom@18.2.0",
          "lucide-react": "https://esm.sh/lucide-react@0.471.0?deps=react@18.2.0"
        }
      }
    </script>
  </head>
  <body class="min-h-screen bg-gradient-to-b from-slate-100 to-slate-200">
    <div id="root"></div>

    <script type="module">
      import React, { useEffect, useState } from "react";
      import { createRoot } from "react-dom/client";
      import {
        motion,
        AnimatePresence,
        useAnimation,
        useMotionValue,
        useTransform
      } from "framer-motion";
      import {
        Check,
        X,
        RotateCcw,
        ListChecks,
        ArrowLeft,
        ArrowRight,
        Undo2
      } from "lucide-react";

      const defaultQuestions = [
        `Bist du mit Herrn Heyer per Du?`,
        `Warst du schonmal in der Klassenstunde besoffen?`,
        `Hast du nach einem Klassenbesäufnis deinen Magen über den Oralausgang entleert?`,
        `Hast du schonmal Herrn Heyer im Gesangsunterricht widersprochen?`,
        `Hattest du schonmal deine Repertoireliste für ein Semester nicht komplett gelernt?`,
        `Hast du schonmal einen Meisterkurs außerhalb der Hochschule bei einem anderen Professor gemacht, während du in der Heyer-Klasse warst?`,
        `Hast du Herrn Heyer schonmal eine Sprachmemo gesendet?`,
        `Hast du Herrn Heyer schonmal außerhalb der gewünschten Zeiten kontaktiert?`,
        `Hast du von Herrn Heyer schonmal viel zu spät ein Empfehlungsschreiben gefordert?`,
        `Hast du Herrn Heyers Unterschrift schonmal für ein Empfehlungsschreiben genutzt, das er nie zu sehen bekommen hat?`,
        `Hat Herr Heyer schonmal "Nicht der/die Beste, aber der/die Lustigste" zu dir gesagt?`,
        `Hast du schonmal in A322 Sex gehabt?`,
        `Hattest du schonmal alkoholisiert Gesangsunterricht bei Herrn Heyer?`,
        `Hattest du schonmal high Unterricht bei Herrn Heyer?`,
        `Hast du schonmal jemanden aus der Heyer Klasse geküsst?`,
        `Hast du schonmal eine andere Person aus der Klasse nackt gesehen?`,
        `Hast du schonmal zu dritt mit Leuten aus der Heyer-Klasse in einem Bett geschlafen?`,
        `Hast du schonmal mit einem Kater ein Konzert gesungen?`,
        `Hast du schonmal betrunken ein Konzert gesungen?`,
        `Hat Heyer schonmal angedeutet dich aus der Klasse zu werfen?`,
        `Hast du schonmal einen Streit um ein Stück von Violetta gehabt?`,
        `Hat dir ein anderer Dozent schonmal gesagt, du singst "zu laut"?`,
        `Hast du schonmal Repertoire gesungen für das du "zu jung" bist?`,
        `Hast du Herrn Heyer schonmal angeschrien?`,
        `Warst du schonmal kurz davor das Studium abzubrechen oder den Lehrer zu wechseln?`,
        `Hast du schonmal mit Herrn Heyer gemeinsam ein Stück bei einem Konzert gesungen?`,
        `Hast du mal mit einem Heyer-Schüler zusammen gewohnt/tust du es noch?`,
        `Warst du mal mit einem Heyer-Schüler zusammen/bist du es noch?`,
        `Hast du schonmal eine Arie in einer Karaokebar gesungen?`,
        `Hast du schonmal eine italienische Arie gesungen, aber eigentlich nur irgendeine Fantasiesprache wiedergegeben?`,
        `Hast du schonmal in Herrn Heyers Unterricht geweint?`,
        `Hast du schon in Lenas Freundebuch geschrieben?`,
        `Wurde dir schon einmal gesagt, dass du in einer Sekte studierst?`,
        `Hast du schonmal an einem Abend 10 Kölsch konsumiert?`,
        `Hast du schonmal an einem Abend 25 Kölsch konsumiert?`,
        `Hast du schonmal in einer Klassenstunde nicht gesungen?`,
        `Hattest du schonmal einen Filmriss von einem Abend mit der Klasse?`,
        `Hast du schonmal zusammen mit anderen Heyer-Schülern gekifft?`,
        `Hast du schonmal Herrn Heyer geghosted?`,
        `Hattest du schonmal eine Therapiestunde mit Herrn Heyer?`,
        `War dir schonmal am Frühstückstisch von Herrn Heyer übel?`
      ];

      function useKeyControls(enabled, onYes, onNo, onRestart) {
        useEffect(() => {
          if (!enabled) return;
          const handler = (e) => {
            if (e.key === "ArrowRight") {
              e.preventDefault();
              onYes();
            } else if (e.key === "ArrowLeft") {
              e.preventDefault();
              onNo();
            } else if (e.key.toLowerCase() === "r") {
              onRestart?.();
            }
          };
          window.addEventListener("keydown", handler);
          return () => window.removeEventListener("keydown", handler);
        }, [enabled, onYes, onNo, onRestart]);
      }

      const SwipeCard = ({ question, onSwipe, index, total }) => {
        const x = useMotionValue(0);
        const rotate = useTransform(x, [-240, 0, 240], [-15, 0, 15]);
        const opacity = useTransform(x, [-240, 0, 240], [0.6, 1, 0.6]);
        const controls = useAnimation();

        const thresholdOffset = 120; // pixels
        const velocityThreshold = 800; // px/s

        useEffect(() => {
          controls.start({ y: 0, opacity: 1, transition: { duration: 0.2 } });
        }, [controls]);

        const handleDragEnd = async (_e, info) => {
          const { offset, velocity } = info;
          const goRight = offset.x > thresholdOffset || velocity.x > velocityThreshold;
          const goLeft = offset.x < -thresholdOffset || velocity.x < -velocityThreshold;

          if (goRight) {
            await controls.start({ x: 600, rotate: 20, opacity: 0, transition: { duration: 0.25 } });
            onSwipe("yes");
          } else if (goLeft) {
            await controls.start({ x: -600, rotate: -20, opacity: 0, transition: { duration: 0.25 } });
            onSwipe("no");
          } else {
            await controls.start({ x: 0, rotate: 0, transition: { type: "spring", stiffness: 400, damping: 30 } });
          }
        };

        const yesStrength = useTransform(x, [0, 160], [0, 1]);
        const noStrength = useTransform(x, [0, -160], [0, 1]);

        return React.createElement(
          motion.div,
          {
            className: "relative w-full max-w-md select-none",
            style: { x, rotate, opacity },
            drag: "x",
            dragConstraints: { left: 0, right: 0 },
            onDragEnd: handleDragEnd,
            initial: { y: 16, opacity: 0 },
            animate: controls,
            exit: { y: -16, opacity: 0 }
          },
          React.createElement(
            "div",
            { className: "absolute -top-8 left-0 text-sm text-slate-500" },
            `Frage ${index + 1} von ${total}`
          ),
          React.createElement(
            "div",
            {
              className:
                "relative rounded-3xl bg-white/90 backdrop-blur shadow-xl ring-1 ring-black/5 p-6 md:p-8"
            },
            React.createElement(
              "div",
              { className: "text-center text-xl md:text-2xl font-semibold leading-snug" },
              question
            ),
            React.createElement(
              motion.div,
              {
                className:
                  "pointer-events-none absolute inset-0 flex items-start justify-start p-4",
                style: { opacity: noStrength }
              },
              React.createElement(
                "div",
                {
                  className:
                    "inline-flex items-center gap-2 rounded-2xl border border-red-200 bg-red-50 px-3 py-1 text-red-700 text-sm"
                },
                React.createElement(X, { className: "h-4 w-4" }),
                " NO"
              )
            ),
            React.createElement(
              motion.div,
              {
                className:
                  "pointer-events-none absolute inset-0 flex items-start justify-end p-4",
                style: { opacity: yesStrength }
              },
              React.createElement(
                "div",
                {
                  className:
                    "inline-flex items-center gap-2 rounded-2xl border border-emerald-200 bg-emerald-50 px-3 py-1 text-emerald-700 text-sm"
                },
                React.createElement(Check, { className: "h-4 w-4" }),
                " YES"
              )
            )
          )
        );
      };

      function App() {
        const [index, setIndex] = useState(0);
        const [yesCount, setYesCount] = useState(0);
        const [answers, setAnswers] = useState([]);

        const questions = defaultQuestions;
        const n = questions.length;
        const finished = index >= n;
        const xValue = finished ? n - yesCount : null;

        const answer = (yn) => {
          if (finished) return;
          setAnswers((a) => [...a, yn]);
          if (yn === "yes") setYesCount((c) => c + 1);
          setIndex((i) => i + 1);
        };

        const restart = () => {
          setIndex(0);
          setYesCount(0);
          setAnswers([]);
        };

        const goBack = () => {
          if (index === 0) return;
          const last = answers[answers.length - 1];
          if (last === "yes") setYesCount((c) => Math.max(0, c - 1));
          setAnswers((a) => a.slice(0, -1));
          setIndex((i) => Math.max(0, i - 1));
        };

        return React.createElement(
          "div",
          { className: "min-h-screen w-full flex flex-col items-center" },
          React.createElement(
            "header",
            {
              className:
                "w-full max-w-3xl px-4 md:px-6 py-6 flex items-center justify-between"
            },
            React.createElement(
              "div",
              { className: "flex items-center gap-3" },
              React.createElement(ListChecks, { className: "h-6 w-6 text-slate-700" }),
              React.createElement(
                "h1",
                { className: "text-xl md:text-2xl font-bold text-slate-800" },
                "The rice Heyer purity test"
              )
            ),
            React.createElement(
              "div",
              { className: "flex items-center gap-2" },
              React.createElement(
                "button",
                {
                  onClick: restart,
                  className:
                    "rounded-xl px-3 py-2 text-sm font-medium bg-white shadow hover:shadow-md ring-1 ring-slate-200 flex items-center gap-2",
                  title: "Restart (R)"
                },
                React.createElement(RotateCcw, { className: "h-4 w-4" }),
                " Restart"
              )
            )
          ),
          React.createElement(
            "main",
            { className: "flex-1 w-full px-4 md:px-6 pb-24 flex flex-col items-center" },
            !finished
              ? React.createElement(
                  "div",
                  { className: "w-full flex flex-col items-center gap-6" },
                  React.createElement(
                    "div",
                    { className: "w-full max-w-md" },
                    React.createElement(
                      "div",
                      { className: "h-2 w-full bg-white/60 rounded-full shadow-inner overflow-hidden" },
                      React.createElement("div", {
                        className: "h-full bg-slate-900",
                        style: { width: `${(index / Math.max(1, n)) * 100}%` }
                      })
                    ),
                    React.createElement(
                      "div",
                      { className: "mt-2 text-center text-sm text-slate-600" },
                      n > 0 ? `${index} / ${n} answered` : "No questions yet"
                    )
                  ),
                  React.createElement(
                    AnimatePresence,
                    { mode: "popLayout" },
                    n > 0 &&
                      React.createElement(SwipeCard, {
                        key: index,
                        question: questions[index],
                        index: index,
                        total: n,
                        onSwipe: answer
                      })
                  ),
                  React.createElement(
                    "div",
                    { className: "mt-2 flex items-center gap-3" },
                    React.createElement(
                      "button",
                      {
                        onClick: goBack,
                        disabled: index === 0,
                        className:
                          "rounded-2xl px-4 py-3 text-base font-semibold ring-1 ring-slate-300 bg-white shadow hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",
                        title: "Back"
                      },
                      React.createElement(Undo2, { className: "h-5 w-5" }),
                      " Back"
                    ),
                    React.createElement(
                      "button",
                      {
                        onClick: () => answer("no"),
                        className:
                          "rounded-2xl px-5 py-3 text-base font-semibold ring-1 ring-slate-300 bg-white shadow hover:shadow-md flex items-center gap-2",
                        title: "No (←)"
                      },
                      React.createElement(ArrowLeft, { className: "h-5 w-5" }),
                      " No"
                    ),
                    React.createElement(
                      "button",
                      {
                        onClick: () => answer("yes"),
                        className:
                          "rounded-2xl px-5 py-3 text-base font-semibold bg-slate-900 text-white shadow hover:shadow-md flex items-center gap-2",
                        title: "Yes (→)"
                      },
                      "Yes ",
                      React.createElement(ArrowRight, { className: "h-5 w-5" })
                    )
                  )
                )
              : React.createElement(
                  "div",
                  { className: "w-full max-w-2xl" },
                  React.createElement(
                    "div",
                    { className: "rounded-3xl bg-white p-8 md:p-10 shadow-xl ring-1 ring-black/5" },
                    React.createElement(
                      "div",
                      {
                        className:
                          "text-5xl md:text-6xl font-black tracking-tight tabular-nums text-center",
                        "aria-label": "X"
                      },
                      xValue
                    ),
                    React.createElement(
                      "p",
                      { className: "mt-3 text-center text-slate-600 italic" },
                      "Do not use this as checklist. Completing it would likely result in Herrn Heyer throwing you out of the class."
                    ),
                    React.createElement(
                      "div",
                      { className: "mt-6 grid grid-cols-1 sm:grid-cols-2 gap-3" },
                      React.createElement(
                        "button",
                        {
                          onClick: goBack,
                          className:
                            "rounded-2xl px-4 py-3 font-semibold bg-white ring-1 ring-slate-200 shadow hover:shadow-md flex items-center justify-center gap-2"
                        },
                        React.createElement(Undo2, { className: "h-5 w-5" }),
                        " Back"
                      ),
                      React.createElement(
                        "button",
                        {
                          onClick: restart,
                          className:
                            "rounded-2xl px-4 py-3 font-semibold bg-slate-900 text-white shadow hover:shadow-md flex items-center justify-center gap-2"
                        },
                        React.createElement(RotateCcw, { className: "h-5 w-5" }),
                        " Restart"
                      )
                    ),
                    React.createElement(
                      "div",
                      { className: "mt-8" },
                      React.createElement(
                        "h3",
                        { className: "text-base font-semibold text-slate-800 mb-3" },
                        "Your answers"
                      ),
                      React.createElement(
                        "ul",
                        { className: "space-y-2" },
                        questions.map((q, i) =>
                          React.createElement(
                            "li",
                            { key: i, className: "flex items-start gap-3" },
                            React.createElement(
                              "div",
                              {
                                className:
                                  "mt-1 inline-flex h-6 w-6 shrink-0 items-center justify-center rounded-full " +
                                  (answers[i] === "yes"
                                    ? "bg-emerald-100 text-emerald-700"
                                    : "bg-red-100 text-red-700")
                              },
                              answers[i] === "yes"
                                ? React.createElement(Check, { className: "h-4 w-4" })
                                : React.createElement(X, { className: "h-4 w-4" })
                            ),
                            React.createElement("span", { className: "text-slate-700" }, q)
                          )
                        )
                      )
                    )
                  )
                )
          ),
          React.createElement(
            "footer",
            {
              className:
                "w-full max-w-3xl px-4 md:px-6 py-6 text-center text-xs text-slate-500"
            },
            "Tipp: Karten nach links für NO oder rechts für YES wischen. Pfeiltasten funktionieren auch."
          )
        );
      }

      const root = createRoot(document.getElementById("root"));
      root.render(React.createElement(App));
    </script>
  </body>
</html>
